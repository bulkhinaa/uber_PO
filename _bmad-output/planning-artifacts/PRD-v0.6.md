# PRD v0.6 — ИИ-помощник для CPO (Telegram, voice-only) на базе BMAD agentic core

## 0) Метаданные документа

* **Продукт:** голосовой помощник для CPO в Telegram (MVP).
* **Версия PRD:** v0.6 (консолидировано: R1–R9 + FR-013/FR-014 + R10).
* **Тип интерфейса:** voice-only (без кнопок/форм).
* **Источник правды (SoT):** PostgreSQL.
* **Ключевой принцип:** agentic core в духе BMAD (агенты + guided workflows + party mode + артефакты + трассировка/аудит + rules/workflows/agents as code).

---

## 1) Проблема и контекст

### 1.1 Проблема пользователя

CPO ведёт **20+ активных проектов** и **3+ команд**, живёт в постоянной смене контекста (статусы/риски/встречи/решения/поручения/релизы). Основная боль:

* тяжело держать "радар": **что горит / где риск / что изменилось**;
* решения и поручения теряются между чатами/встречами/доками;
* нет единого места, где "правда" связана (проекты ↔ фичи ↔ релизы ↔ риски ↔ решения ↔ поручения ↔ артефакты);
* времени на "формальные" записи нет — нужен **голосовой capture** и "короткие ответы".

### 1.2 Почему Telegram + voice-only

* максимально быстрый канал (везде, на ходу);
* голос — снижает когнитивную стоимость фиксации;
* voice-only дисциплинирует UX: **коротко, ясно, с контекстом, с ремонтом ошибок**.

---

## 2) Видение продукта

**ИИ-помощник для CPO**, который помогает "контролировать всё" по цепочке:
**идеи → проекты → справки/доки → фичи (≈2 недели) → релизы → статусы/риски/изменения → встречи/решения → поручения/напоминания → исследования "не тревожь меня"**.

Всегда отвечает на 3 вопроса:

1. **Что горит?**
2. **Где риск?**
3. **Что изменилось?**
   И умеет: готовить к встречам, протоколировать, создавать поручения/напоминания, запускать исследования "под капотом".

---

## 3) Цели, метрики, non-goals

### 3.1 Цели (MVP, 3 месяца)

1. Ежедневное использование для: capture → статусы/риски/изменения → встречи/решения → поручения/напоминания.
2. Голосом создаются/обновляются сущности, формируются **справки/PRD-lite**, выдаются отчёты "горит/риск/изменилось".
3. Исследования запускаются "не тревожь меня" и возвращаются **1-страничным one-pager** с источниками/допущениями.
4. Система стабильна: история, контекст, EventLog, аудит.

### 3.2 Главная метрика успеха

* **DAU** + измеримая **экономия времени/энергии** (proxy: скорость закрытия capture/meeting→actions, снижение "repair", рост completion).

### 3.3 Дополнительные метрики

* **Command Success Rate** (голос→правильное действие без ремонта)
* **Context Correctness Rate** (ошибки активного проекта)
* **Clarification Rate** (доля ответов с уточнением; правило ≤1)
* **Repair/Undo Rate**
* **Radar Trust**: доля top-items с explainability
* **Leader SLA**: просроченные/закрытые leader-P1

### 3.4 Non-goals (MVP)

* детальное планирование спринтов и микроменеджмент уровня PO;
* "полная Jira-замена";
* UI с формами/кнопками (только голос и текстовые ответы).

---

## 4) Пользователи и сценарии

### 4.1 Primary persona

* CPO, 3+ команды, 20+ проектов, высокая когнитивная нагрузка.

### 4.2 Единицы управления (доменные сущности)

* **Project** — контейнер.
* **Feature** — единица разработки ~2 недели.
* **Assignment** — поручение с дедлайном/напоминаниями.
* **Artifact** — документ/результат (brief/report/minutes/prep/research).

### 4.3 Ключевые user journeys (MVP)

1. **Voice capture**: "Идея по проекту X…" → запись → EventLog → (опц.) авто-линк.
2. **Статус апдейт фичи**: "Поменяй статус… причина…" → история → влияет на Radar.
3. **Radar**: "Что горит?" → Top-3 + почему + next step.
4. **Meeting minutes**: голос→протокол → решения/поручения/риски/изменения.
5. **Meeting prep**: "подготовь к встрече…" → 1-page + вопросы/риски.
6. **Leader Inbox**: "Поручение от руководителя…" → отдельный inbox → разбор → влияет на Radar.
7. **Research 'не тревожь'**: "Исследуй…" → one-pager + источники/допущения.
8. **Party mode**: "Analyst+PM+Risk 30 минут…" → консолидация → артефакт.

---

## 5) Принципы продукта (обязательные)

1. **Voice-only**
2. **Единый SoT:** PostgreSQL
3. **Agentic-core first**
4. **Артефакты важнее чата:** всё ценное сохраняется
5. **Контекст всегда виден**
6. **Explainability:** "горит/риск" всегда с "почему"
7. **1 уточняющий вопрос максимум**
8. **Repair/Undo** обязательны

---

## 6) BMAD Agentic Core (MUST, Definition of Done)

### 6.1 Реестр агентов

Команда: "Покажи доступных агентов"
Ответ: список, назначение, примеры команд, какие артефакты создаёт.

### 6.2 Ручной вызов агента (voice-only)

* "Вызови агента Аналитик. Задача: …"
* "Переключись на Исследователя"
* "Выйди из агента / заверши сессию агента"

### 6.3 Оркестратор + guided workflows

* "Запусти workflow 'Бриф → PRD-lite' по проекту X"
* Оркестратор ведёт шаги, делает handoff, сохраняет артефакты.

### 6.4 Party mode

* "Party mode: Аналитик + PM + Risk Manager. Таймбокс 30 минут. Тема: …"
* Итог: консолидированный артефакт + решения/риски/next steps.

### 6.5 Трассировка и аудит

У каждого результата:

* какой агент/workflow,
* какие входы,
* какие источники (интернет/заметки/БД),
* какие артефакты созданы,
* **EventLog** на любые изменения.

### 6.6 Agents/Workflows/Rules as code

* декларативные YAML/JSON конфиги, версионирование, миграции.

---

## 7) Состав агентов (MVP)

1. **Orchestrator** — маршрутизация, workflow-шаги, handoff, QC.
2. **Analyst** — брифы/структуры/справки v1, уточнения.
3. **PM / PRD Writer** — PRD-lite, user stories, AC.
4. **Researcher** — "не тревожь", one-pager, источники/допущения.
5. **Meeting Secretary** — minutes → decisions/actions/risks/changes.
6. **Risk Manager** — "где риск/что горит" + причины.
7. **Release Manager** — релизы/переносы/состав.
8. **Reviewer** — чеклисты полноты/согласованности/стандарты R9.

---

## 8) Guided Workflows (MVP)

### W1. Voice Intake (Capture & Classify)

**Вход:** voice → transcript → intent → entities → запись в БД → EventLog
**Выход:** Idea/Note/Meeting/Assignment/StatusUpdate (+ ссылки)

### W2. Project/Feature Brief

**Выход:** Brief artifact + метрики + история + риски + зависимости + релизы

### W3. Meeting Minutes → Actions

**Выход:** Meeting artifact + Decisions + Assignments + Risks + статус-ивенты

### W4. Radar: "горит/риск/изменилось"

**Выход:** Report artifact + причины + ссылки на сущности

### W5. Meeting Prep

**Выход:** 1-page prep + вопросы/фокус + ссылки

### W6. Research "не тревожь"

**Выход:** One-pager (строгий формат) + источники/допущения + next steps

### W7. Таймбокс-брейншторм

**Выход:** Brainstorm artifact + идеи/риски/решения/next steps

### W8. Leader Tasks Inbox

**Вход:** "Поручение от руководителя: …"
**Выход:** Assignment(source=leader, inbox=leader) + (опц.) guided разбор/привязка

---

## 9) Voice UX стандарты (R9) — контракт ответов

### 9.1 Строки статуса (обязательно)

* Первая строка: `Контекст: Проект <X>` / `Контекст: Мои идеи (Inbox)` / `Контекст: Все проекты`
* Если режим активен: `Режим: Агент …` / `Режим: Workflow шаг i/n` / `Режим: Party mode …`

### 9.2 Формат ответа

* Итог (1–3 строки) → Top-3 → Next step → навигация ("почему/подробнее/сократи/следующее…")

### 9.3 Уточнения

* максимум **1 уточняющий вопрос**
* дизамбигуация через Top-3 + "1/2/3"

### 9.4 Repair/Undo

* "нет, исправь… / я имел в виду… / отмена / отмени последнее"
* Undo на 1 шаг, запись в EventLog

---

## 10) Информационная архитектура

### 10.1 Корень

* **Мои проекты**
* **Мои идеи (Inbox)**
* **Поручения от руководителя (Leader Inbox)**

### 10.2 Разделы проекта (автосоздание)

* Аналитика / Продукт / Брифинг / Брейншторм / Бэклог / Релизы
* Встречи / Решения / Риски / Поручения / Исследования / Справки/Документы

---

## 11) Контекст и индикатор активного проекта (MUST)

### 11.1 Команды контекста

* "Где я сейчас?" / "Какой активный проект?"
* "Переключись на проект X"
* "Сбрось контекст / Выйди в Мои идеи"
* "По всем проектам: …"
* (опц.) "Закрепи проект X"

### 11.2 Правила контекста

* по умолчанию контекст = Inbox
* "идея по проекту Y" → авто-переключение (если найден)
* если проект не найден → 1 вопрос: "создать новый или сохранить в Inbox?"

---

## 12) Функциональные требования (FR) с критериями приёмки

Ниже — **ключевые FR** (включая FR-013/FR-014) и минимальные AC.

### FR-001 Проекты и структура

**Функции:**

* создать проект голосом
* автосоздать разделы
* голосовой поиск проектов/фич/артефактов

**AC:**

* проект создаётся с уникальным id и дефолтными папками
* поиск возвращает Top-3 при неоднозначности

### FR-002 Inbox идей

**Функции:**

* capture идеи голосом
* привязка к проекту
* превращение идеи в фичу/документ (workflow)

**AC:**

* идея всегда сохраняется даже при неполной информации
* EventLog фиксирует создание/линк

### FR-003 Фичи (2 недели)

**Функции:**

* создать фичу, статус, причина, команды, PO
* история статусов

**AC:**

* статус-апдейт всегда пишет EventLog и причину
* влияет на Radar правила

### FR-004 Связи (Dependency)

**Функции:** "A блокирует B", учёт блокировок в сводках
**AC:** блокировки отражаются в Radar "горит"

### FR-005 Релизы

**Функции:** создать релиз, состав, переносы (дорогая операция)
**AC:** перенос релиза требует подтверждения, пишет EventLog

### FR-006 Протоколы встреч

**Функции:** minutes из голоса + извлечение decisions/actions/risks/changes
**AC:** все extracted сущности связаны с meeting_id и пишут EventLog

### FR-007 Поручения + напоминания

**Функции:** поручение голосом, reminders (за день/2 часа/кастом)
**AC:** дедлайн/ремайндер сохраняются; просрочка учитывается Radar

### FR-008 Radar top-3

**Функции:** "горит/риск/изменилось" + explainability
**AC:** каждый top-item содержит "почему" (rules+data links)

### FR-009 Meeting Prep

**Функции:** 1-page prep + вопросы + критичные моменты
**AC:** создаётся Artifact(prep) и связки к проектам/встречам

### FR-010 Справки по проектам/фичам

**Функции:** цель/описание/метрики/статус/риски/зависимости/релизы/изменения
**AC:** создаётся Artifact(brief) + (опц.) HTML

### FR-011 Исследования "не тревожь меня"

**Функции:** интернет + заметки → one-pager (строгий формат)
**AC:** сохраняются источники/допущения, создаётся Artifact(research)

### FR-012 BMAD agentic core

**Функции:** registry/invoke/workflows/party/tracing/as-code
**AC:** аудит и трассировка обязательны, версии конфигов фиксируются

### FR-013 Auto Rendered HTML Artifacts (NEW)

**Функции:** report/brief/prep/minutes → красивый HTML view + приватная ссылка
**AC:**

* `rendered_url` приватный, трудноугадываемый, TTL
* событие `artifact_rendered`, `artifact_viewed` в EventLog

### FR-014 Leader Tasks Inbox (NEW)

**Функции:** отдельный inbox, guided review, влияние на Radar
**AC:**

* assignment(source=leader, inbox=leader) создаётся всегда
* leader P1 overdue/≤24ч **не подавляется** супрессией

---

## 13) Radar правила и скоринг (v1.1)

### 13.1 Триггеры "Что горит?"

* Feature Blocked
* релиз ≤7 дней и не Ready/Released
* фича блокирует другие
* churn статусов/переносов за период
* активные риски high/medium
* leader-поручения overdue или ≤24ч (повышенный приоритет)

### 13.2 Скоринг

* `raw_score` = сумма правил без супрессии
* `rank_score` = raw − suppression
* Eligibility: "горит" при `raw_score >= threshold`
* **Leader P1** не подавляется

### 13.3 Explainability контракт

Каждый пункт Radar возвращает:

* сработавшие правила
* фактические данные (даты, статусы, связи)
* ссылки на сущности/артефакты

---

## 14) Артефакты и шаблоны

### 14.1 Project brief (1–2 экрана)

* цель/описание
* метрики
* статус
* релизы
* топ-риски
* изменения
* next steps

### 14.2 Feature brief

* цель/описание
* команды+PO
* статус+причина
* зависимости
* релиз
* история
* риски/next

### 14.3 Meeting minutes

* резюме
* решения
* риски
* поручения (кто/что/когда)
* изменения статусов

### 14.4 Research one-pager (строгий формат)

* вопрос
* альтернативы
* сравнение
* рекомендация
* риски
* допущения
* next steps
* источники

---

## 15) HTML страницы артефактов (FR-013)

### 15.1 Обязательные страницы MVP

* Radar report view
* Brief view (project/feature)
* Meeting prep view
* Minutes view

### 15.2 Контракт хранения

Рекомендуется: `Artifact.content_format=json` + стабильный рендер.

### 15.3 Приватность

* приватная ссылка с TTL
* аудит просмотра: `artifact_viewed`
* опционально: одноразовые токены/ротация

---

## 16) Модель данных (PostgreSQL)

### 16.1 Базовые сущности

Project, Idea, Feature, Team, FeatureTeam, Dependency, Release, ReleaseFeature, Meeting, Decision, Risk, Goal, FeatureGoal, Person, Metric, MetricValue, Artifact, EventLog.

### 16.2 Расширение Assignment (Leader Inbox)

* `source_type` = leader | meeting | self | system
* `source_person_id`
* `inbox_type` = general | leader
* `needs_project_link` boolean
* `priority` = P1 | P2 | P3
* `created_from_artifact_id` nullable

### 16.3 Artifact (HTML)

* `content_format` = markdown | json
* `rendered_html`/`rendered_url` nullable
* `render_version` int
* `rendered_at` timestamp

### 16.4 EventLog (новые типы)

* `artifact_rendered`, `artifact_viewed`
* `leader_assignment_created`
* `leader_inbox_review_started/ended`
* `assignment_linked_to_project`

---

## 17) Архитектура (логическая)

### 17.1 Высокоуровневый пайплайн

1. Telegram voice → загрузка/получение файла (Bot API / Local Bot API)
2. ASR → транскрипт
3. NLU → intent + slots + coreference
4. Context resolver → определение активного проекта/режима
5. Orchestrator → выбор агента/workflow
6. Agent execution → чтение/запись в Postgres
7. Artifact builder → сохранение структурированного результата
8. (опц.) HTML render → приватная ссылка + аудит
9. Response composer → ответ по R9 контракту

### 17.2 Идемпотентность и надёжность

* каждое входящее сообщение получает `ingestion_id`
* повторная обработка не создаёт дубликаты (upsert + idempotency keys)
* EventLog — неизменяемый журнал

### 17.3 Observability

* трассировка: message_id → workflow_id → agent_runs → db_writes → artifacts
* метрики качества (см. R10)

---

## 18) Telegram ограничения и решения (R7)

* Bot API download ограничен ~20MB → **Local Bot API Server** как pro-режим
* rate limits → "1 сообщение = 1 результат"
* deep links: start ≤64 символа → ускорение "переключить контекст/открыть артефакт"
* topics-mode — опционально/эксперимент

---

## 19) Безопасность и приватность

* все заметки/артефакты внутри системы
* исследовательские источники фиксируются явно (для доверия)
* HTML ссылки: TTL + аудит + трудноугадываемый токен
* разграничение доступов (минимум: по пользователю; далее — по ролям)

---

## 20) QA и качество диалога (R10 — Conversation QA Pack)

### 20.1 Состав QA-пакета

* Golden Dialogues Library (≥30)
* NLU Intent/Slot Matrix
* ASR Quality Set (≥60 аудио)
* E2E harness (проверки БД/EventLog/ответов/HTML)
* Style linter (R9)
* Quality gates (пороговые метрики)
* Red-team pack

### 20.2 Блокирующие правила (gates)

* нет строки `Контекст:` → FAIL
* > 1 уточняющего вопроса → FAIL
* изменения без EventLog → FAIL
* Radar без "почему" → FAIL
* leader P1 подавлен → FAIL

---

## 21) План реализации (6 спринтов)

**S1** Foundation: voice intake + Postgres + CTX + registry/invoke + EventLog + поиск v1
**S2** Workflows + Artifacts + HTML v1: Orchestrator + W2 + PRD-lite + renderer + audit
**S3** Meetings + Party mode v1 + Leader capture: W3 + party + leader capture/list
**S4** Reminders + Leader review + Radar v1.1: reminders + W8 + Radar + explainability + HTML report
**S5** Releases + Meeting Prep + Risk Manager: релизы + W5 + риск-модель
**S6** Researcher + Reviewer + Hardening + as-code: "не тревожь" + reviewer + конфиги

---

## 22) Открытые вопросы (фиксируем как backlog)

1. Точный формат хранения `Artifact.content_format=json` (схемы по типам артефактов).
2. Стратегия coreference ("это/там/по нему") и контекстного разрешения.
3. Настройка TTL/политики доступа для HTML ссылок (внутренний хостинг/прокси).
4. Политика подтверждений для "дорогих" операций (массовые переносы/удаления).
5. Версионирование rules/workflows/agents и миграции при изменении схемы.

---

## 23) Приложение A — Словарь голосовых команд (MVP)

* Контекст: "Где я сейчас?", "Переключись на проект X", "Сбрось контекст", "По всем проектам…"
* Агенты: "Покажи доступных агентов", "Вызови агента…", "Выйди из агента"
* Workflows: "Запусти workflow…", "Останови workflow", "Прогресс"
* Проекты/идеи: "Создай проект…", "Идея по проекту…", "Покажи мои идеи…"
* Фичи/статусы: "Создай фичу…", "Поменяй статус… причина…"
* Встречи: "Сделай протокол…", "Подготовь к встрече…"
* Radar: "Что горит?", "Где риск?", "Что изменилось за неделю?"
* Поручения: "Поручение… до… напомни…"
* Leader: "Поручение от руководителя…", "Покажи поручения от руководителя", "Разбери…"
* HTML: "Сгенерируй сайт…", "Открой сайт последнего отчёта", "Без сайта"

---

## 24) Приложение B — Мини-пример "as-code" (для агента-разработчика)

```yaml
agents:
  - id: orchestrator
    name: Orchestrator
    responsibilities: [route_intents, run_workflows, handoff, quality_control, audit]
    produces_artifacts: [brief, report, minutes, prep, prd_lite]

workflows:
  - id: w4_radar
    name: Radar: hot/risk/changed
    steps:
      - detect_scope_and_context
      - fetch_signals_from_db
      - score_items_with_rules
      - build_explainability
      - save_artifact_report
      - render_html_if_enabled
      - compose_voice_response

radar_rules:
  - id: leader_p1_urgent
    description: "Leader P1 overdue or <=24h must surface"
    raw_score: 100
    suppressible: false
```
