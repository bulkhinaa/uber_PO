# PRD v0.7 — ИИ-помощник для CPO (Telegram, voice-only) на базе BMAD agentic core

## 0) Метаданные документа

* **Продукт:** голосовой помощник для CPO в Telegram (MVP).
* **Версия PRD:** v0.7 (исправления по validation report: структура + measurability).
* **Дата:** 2026-01-29
* **Тип интерфейса:** voice-only (без кнопок/форм).
* **Источник правды (SoT):** PostgreSQL.
* **Ключевой принцип:** мультиагентная архитектура с guided workflows, party mode, артефактами, трассировкой и аудитом.

---

## Executive Summary

**Голосовой ИИ-помощник для CPO** в Telegram, позволяющий управлять 20+ проектами и 3+ командами через естественный голосовой интерфейс.

**Что это:** Voice-first продукт для быстрого capture идей, статусов, решений и поручений. Всегда отвечает на 3 вопроса: **"Что горит? Где риск? Что изменилось?"**

**Для кого:** CPO с высокой когнитивной нагрузкой, живущий в постоянной смене контекста между проектами, командами, встречами и решениями.

**Дифференциатор:**
* **Voice-only** — снижает когнитивную стоимость фиксации
* **Мультиагентная архитектура** — Analyst, PM, Risk Manager, Researcher работают как команда
* **Explainable Radar** — "горит/риск" всегда с "почему" и next step
* **Единый SoT** — проекты ↔ фичи ↔ релизы ↔ риски ↔ решения ↔ поручения связаны

**Ценность:** Экономия 30-60 минут в день на:
* Быстрый capture без контекстного переключения
* Автоматическую подготовку к встречам и протоколирование
* Radar-сводки вместо ручного сканирования статусов
* Исследования "не тревожь меня" в фоновом режиме

---

## 1) Проблема и контекст

### 1.1 Проблема пользователя

CPO ведёт **20+ активных проектов** и **3+ команд**, живёт в постоянной смене контекста (статусы/риски/встречи/решения/поручения/релизы). Боль:

* тяжело держать "радар": **что горит / где риск / что изменилось**;
* решения и поручения теряются между чатами/встречами/доками;
* нет единого места, где "правда" связана (проекты ↔ фичи ↔ релизы ↔ риски ↔ решения ↔ поручения ↔ артефакты);
* времени на "формальные" записи нет — нужен **голосовой capture** и "короткие ответы".

### 1.2 Почему Telegram + voice-only

* максимально быстрый канал (везде, на ходу);
* голос — снижает когнитивную стоимость фиксации;
* voice-only дисциплинирует UX: **коротко, ясно, с контекстом, с ремонтом ошибок**.

---

## 2) Видение продукта

**ИИ-помощник для CPO**, который помогает "контролировать всё" по цепочке:
**идеи → проекты → справки/доки → фичи (≈2 недели) → релизы → статусы/риски/изменения → встречи/решения → поручения/напоминания → исследования "не тревожь меня"**.

Всегда отвечает на 3 вопроса:

1. **Что горит?**
2. **Где риск?**
3. **Что изменилось?**

И умеет: готовить к встречам, протоколировать, создавать поручения/напоминания, запускать исследования "под капотом".

---

## Product Scope

### In Scope (MVP)

**Core Capabilities:**
* Voice capture идей, статусов, решений
* Project/Feature management (создание, статусы, зависимости)
* Radar сводки "горит/риск/изменилось"
* Meeting minutes и prep (протоколы и подготовка)
* Assignment tracking с напоминаниями
* Leader Inbox (приоритетные поручения от руководителя)
* Research "не тревожь меня" (фоновые исследования с one-pager)
* Party mode (мультиагентные сессии: Analyst+PM+Risk)
* HTML артефакты (красивые отчёты с приватными ссылками)

**Entities:**
* Projects, Features (~2 недели), Releases, Dependencies, Meetings, Decisions, Risks, Assignments, Artifacts

**Workflows:**
* Voice Intake → Capture & Classify
* Project/Feature Brief generation
* Meeting Minutes → Actions extraction
* Radar Report generation
* Meeting Prep generation
* Research one-pager generation
* Party mode brainstorming

### Out of Scope (MVP)

* Детальное sprint planning и микроменеджмент уровня PO
* "Полная Jira-замена" (интеграции с Jira/Asana/Linear)
* UI с формами/кнопками (только голос и текстовые ответы)
* Team dashboards и visualizations
* Multi-user collaboration (только single CPO в MVP)
* Predictive analytics и AI-прогнозы

### Future Considerations

* Интеграции: Jira, Linear, Asana, Notion (двусторонняя синхронизация)
* Team mode: shared projects, delegation workflows
* Advanced analytics: velocity trends, risk predictions, burndown
* Mobile app (iOS/Android) в дополнение к Telegram
* Voice synthesis для ответов (сейчас только текст)

---

## Success Criteria

### 3.1 Цели (MVP)

1. Ежедневное использование для: capture → статусы/риски/изменения → встречи/решения → поручения/напоминания.
2. Голосом создаются/обновляются сущности, формируются **справки/PRD-lite**, выдаются отчёты "горит/риск/изменилось".
3. Исследования запускаются "не тревожь меня" и возвращаются **1-страничным one-pager** с источниками/допущениями.
4. Система стабильна: история, контекст, аудит всех изменений.

### 3.2 Главная метрика успеха

* **DAU ≥ 5 дней/неделю** (ежедневное использование)
* **Экономия времени ≥ 30 минут/день** (proxy: скорость закрытия capture/meeting→actions, снижение manual status checks)

### 3.3 Дополнительные метрики

* **Command Success Rate ≥ 85%** — голос→правильное действие без ремонта (ASR+NLU accuracy)
* **Context Correctness Rate ≥ 90%** — активный проект определён верно
* **Clarification Rate ≤ 20%** — доля ответов с уточнением (цель: ≤1 уточняющий вопрос)
* **Repair/Undo Rate ≤ 15%** — доля команд, требующих исправления
* **Radar Trust ≥ 80%** — доля top-items, где explainability признана полезной (user feedback)
* **Leader SLA ≥ 95%** — leader-P1 поручения закрыты в срок

### 3.4 Non-goals (MVP)

* детальное планирование спринтов и микроменеджмент уровня PO;
* "полная Jira-замена";
* UI с формами/кнопками (только голос и текстовые ответы).

---

## User Journeys

### 4.1 Primary persona

* **CPO**, 3+ команды, 20+ проектов, высокая когнитивная нагрузка.
* Проводит 15-20 встреч в неделю, переключается между контекстами каждые 30-60 минут.
* Нет времени на "формальные записи" — нужен быстрый capture на ходу.

### 4.2 Единицы управления (доменные сущности)

* **Project** — контейнер.
* **Feature** — единица разработки ~2 недели.
* **Release** — версия продукта, содержит Features.
* **Dependency** — блокировка между Features.
* **Meeting** — встреча с решениями, рисками, поручениями.
* **Decision** — решение, принятое на встрече или самостоятельно.
* **Risk** — риск с severity и mitigation.
* **Assignment** — поручение с дедлайном/напоминаниями.
* **Artifact** — документ/результат (brief/report/minutes/prep/research).

### 4.3 Ключевые user journeys (MVP)

#### Journey 1: Voice capture
**Trigger:** Идея приходит на ходу (в такси, между встречами)
**Flow:** "Идея по проекту X…" → запись → система сохраняет в Inbox или авто-линкует к проекту → подтверждение
**Outcome:** Идея зафиксирована за 10-15 секунд, аудит создан

#### Journey 2: Статус апдейт фичи
**Trigger:** Статус фичи изменился (In Progress → Blocked)
**Flow:** "Поменяй статус фичи Y на Blocked, причина: зависимость от API" → система сохраняет статус + причину → влияет на Radar
**Outcome:** История статусов обновлена, Radar пересчитан

#### Journey 3: Radar "что горит?"
**Trigger:** Утро понедельника, нужен быстрый обзор
**Flow:** "Что горит?" → система возвращает Top-3 items с explainability (почему горит, что делать) → навигация "почему/подробнее"
**Outcome:** CPO знает топ-приоритеты за 30 секунд

#### Journey 4: Meeting minutes
**Trigger:** Встреча закончилась, нужен протокол
**Flow:** "Сделай протокол последней встречи" → система извлекает решения/поручения/риски/изменения статусов → сохраняет артефакт
**Outcome:** Протокол готов, поручения созданы автоматически

#### Journey 5: Meeting prep
**Trigger:** Через час встреча, нужна подготовка
**Flow:** "Подготовь к встрече по проекту X" → система генерирует 1-page prep (статус, риски, вопросы) → HTML артефакт
**Outcome:** CPO подготовлен за 2 минуты, можно поделиться ссылкой

#### Journey 6: Leader Inbox
**Trigger:** Руководитель дал поручение (устно или в чате)
**Flow:** "Поручение от руководителя: провести аудит безопасности, до пятницы" → система создаёт Assignment(source=leader, priority=P1) → guided review → линкует к проекту
**Outcome:** Leader-поручения не теряются, влияют на Radar с повышенным приоритетом

#### Journey 7: Research "не тревожь меня"
**Trigger:** Нужно исследовать вопрос, но нет времени сейчас
**Flow:** "Исследуй: какие фреймворки для real-time collaboration лучше для нашего кейса" → система работает в фоне (интернет + заметки) → возвращает one-pager с альтернативами/сравнением/рекомендацией
**Outcome:** CPO получает structured research за 15-30 минут без своего участия

#### Journey 8: Party mode
**Trigger:** Сложный вопрос, требующий разных перспектив
**Flow:** "Party mode: Analyst + PM + Risk Manager, 30 минут. Тема: стратегия запуска фичи X" → агенты обсуждают → консолидированный артефакт
**Outcome:** Многосторонний анализ за один запрос

#### Journey 9: Создать/найти проект
**Trigger:** Новый проект или поиск существующего
**Flow:** "Создай проект Mobile App Redesign" ИЛИ "Найди проект по редизайну" → система создаёт/находит → переключает контекст
**Outcome:** Проект создан/найден, контекст переключен

#### Journey 10: Отметить зависимость
**Trigger:** Фича A блокирует фичу B
**Flow:** "Фича API Integration блокирует фичу Mobile UI" → система создаёт Dependency → влияет на Radar
**Outcome:** Блокировка зафиксирована, Radar учитывает

#### Journey 11: Создать/изменить релиз
**Trigger:** Планирование релиза или перенос фич
**Flow:** "Создай релиз v2.0 на 15 февраля" ИЛИ "Перенеси фичу X в релиз v2.1" → система запрашивает подтверждение (дорогая операция) → сохраняет
**Outcome:** Релиз создан/обновлён, аудит зафиксирован

#### Journey 12: Создать поручение с напоминанием
**Trigger:** Нужно создать task себе или кому-то
**Flow:** "Поручение: review архитектуры до среды, напомни за день" → система создаёт Assignment + reminder
**Outcome:** Поручение создано, напоминание придёт за 24 часа

#### Journey 13: Запросить справку
**Trigger:** Нужен overview проекта или фичи
**Flow:** "Дай справку по проекту X" → система генерирует brief (цель, метрики, статус, риски, релизы, изменения)
**Outcome:** 1-2 экрана structured overview, опционально HTML

#### Journey 14: Переключить контекст
**Trigger:** Переключение между проектами
**Flow:** "Переключись на проект Y" → система меняет активный проект → подтверждение "Контекст: Проект Y"
**Outcome:** Все следующие команды работают в контексте проекта Y

#### Journey 15: Исправить ошибку (Repair/Undo)
**Trigger:** Команда распознана неправильно
**Flow:** "Нет, я имел в виду проект X, а не Z" ИЛИ "Отмени последнее" → система откатывает/исправляет → аудит изменения
**Outcome:** Ошибка исправлена за 1 шаг

---

## 5) Принципы продукта (обязательные)

1. **Voice-only**
2. **Единый SoT:** PostgreSQL
3. **Мультиагентная архитектура** (Analyst, PM, Risk Manager, Researcher, Orchestrator)
4. **Артефакты важнее чата:** всё ценное сохраняется
5. **Контекст всегда виден**
6. **Explainability:** "горит/риск" всегда с "почему"
7. **1 уточняющий вопрос максимум**
8. **Repair/Undo** обязательны

---

## 6) Мультиагентная архитектура (MUST, Definition of Done)

### 6.1 Реестр агентов

Команда: "Покажи доступных агентов"
Ответ: список, назначение, примеры команд, какие артефакты создаёт.

### 6.2 Ручной вызов агента (voice-only)

* "Вызови агента Аналитик. Задача: …"
* "Переключись на Исследователя"
* "Выйди из агента / заверши сессию агента"

### 6.3 Оркестратор + guided workflows

* "Запусти workflow 'Бриф → PRD-lite' по проекту X"
* Оркестратор ведёт шаги, делает handoff, сохраняет артефакты.

### 6.4 Party mode

* "Party mode: Аналитик + PM + Risk Manager. Таймбокс 30 минут. Тема: …"
* Итог: консолидированный артефакт + решения/риски/next steps.

### 6.5 Трассировка и аудит

У каждого результата:

* какой агент/workflow выполнил операцию,
* какие входные данные использовались,
* какие источники (интернет/заметки/БД),
* какие артефакты созданы,
* аудит всех изменений сохраняется

### 6.6 Agents/Workflows/Rules as code

* декларативные YAML/JSON конфиги, версионирование, миграции.

---

## 7) Состав агентов (MVP)

1. **Orchestrator** — маршрутизация, workflow-шаги, handoff, QC.
2. **Analyst** — брифы/структуры/справки v1, уточнения.
3. **PM / PRD Writer** — PRD-lite, user stories, AC.
4. **Researcher** — "не тревожь", one-pager, источники/допущения.
5. **Meeting Secretary** — minutes → decisions/actions/risks/changes.
6. **Risk Manager** — "где риск/что горит" + причины.
7. **Release Manager** — релизы/переносы/состав.
8. **Reviewer** — чеклисты полноты/согласованности/стандарты R9.

---

## 8) Guided Workflows (MVP)

### W1. Voice Intake (Capture & Classify)

**Вход:** voice → transcript → intent → entities → запись в БД → аудит
**Выход:** Idea/Note/Meeting/Assignment/StatusUpdate (+ ссылки)

### W2. Project/Feature Brief

**Выход:** Brief artifact + метрики + история + риски + зависимости + релизы

### W3. Meeting Minutes → Actions

**Выход:** Meeting artifact + Decisions + Assignments + Risks + статус-ивенты

### W4. Radar: "горит/риск/изменилось"

**Выход:** Report artifact + причины + ссылки на сущности

### W5. Meeting Prep

**Выход:** 1-page prep + вопросы/фокус + ссылки

### W6. Research "не тревожь"

**Выход:** One-pager (7 разделов) + источники/допущения + next steps

### W7. Таймбокс-брейншторм

**Выход:** Brainstorm artifact + идеи/риски/решения/next steps

### W8. Leader Tasks Inbox

**Вход:** "Поручение от руководителя: …"
**Выход:** Assignment(source=leader, inbox=leader) + (опц.) guided разбор/привязка

---

## 9) Voice UX стандарты (R9) — контракт ответов

### 9.1 Строки статуса (обязательно)

* Первая строка: `Контекст: Проект <X>` / `Контекст: Мои идеи (Inbox)` / `Контекст: Все проекты`
* Если режим активен: `Режим: Агент …` / `Режим: Workflow шаг i/n` / `Режим: Party mode …`

### 9.2 Формат ответа

* Итог (1–3 строки) → Top-3 → Next step → навигация ("почему/подробнее/сократи/следующее…")

### 9.3 Уточнения

* максимум **1 уточняющий вопрос**
* дизамбигуация через Top-3 + "1/2/3"

### 9.4 Repair/Undo

* "нет, исправь… / я имел в виду… / отмена / отмени последнее"
* Undo на 1 шаг, аудит изменения

---

## 10) Информационная архитектура

### 10.1 Корень

* **Мои проекты**
* **Мои идеи (Inbox)**
* **Поручения от руководителя (Leader Inbox)**

### 10.2 Разделы проекта (автосоздание)

* Аналитика / Продукт / Брифинг / Брейншторм / Бэклог / Релизы
* Встречи / Решения / Риски / Поручения / Исследования / Справки/Документы

---

## 11) Контекст и индикатор активного проекта (MUST)

### 11.1 Команды контекста

* "Где я сейчас?" / "Какой активный проект?"
* "Переключись на проект X"
* "Сбрось контекст / Выйди в Мои идеи"
* "По всем проектам: …"
* (опц.) "Закрепи проект X"

### 11.2 Правила контекста

* по умолчанию контекст = Inbox
* "идея по проекту Y" → авто-переключение (если найден)
* если проект не найден → 1 вопрос: "создать новый или сохранить в Inbox?"

---

## Functional Requirements

Ниже — **ключевые FR** с критериями приёмки (AC).

### FR-001 Проекты и структура

**Функции:**

* Пользователь может создать проект голосом
* Система автоматически создаёт разделы проекта (Аналитика, Продукт, Бэклог, Релизы, Встречи, Решения, Риски, Поручения, Исследования, Справки/Документы)
* Пользователь может найти проект/фичу/артефакт голосом

**AC:**

* Проект создаётся с уникальным id и дефолтными папками
* Поиск возвращает результаты за <1 секунду, точность Top-3 ≥ 85%
* При неоднозначности система возвращает Top-3 варианта для выбора

### FR-002 Inbox идей

**Функции:**

* Пользователь может зафиксировать идею голосом
* Система сохраняет идею в Inbox или привязывает к проекту
* Пользователь может превратить идею в фичу/документ через workflow

**AC:**

* Идея всегда сохраняется даже при неполной информации
* Система фиксирует аудит создания/линковки идеи к проекту

### FR-003 Фичи (2 недели)

**Функции:**

* Пользователь может создать фичу с названием, статусом, причиной статуса, командами, PO
* Система сохраняет историю статусов фичи

**AC:**

* Изменение статуса сохраняет аудит с причиной и временной меткой
* Статус фичи влияет на Radar правила (например, Blocked → "горит")

### FR-004 Связи (Dependency)

**Функции:**
* Пользователь может указать "Фича A блокирует фичу B"
* Система учитывает блокировки в Radar сводках

**AC:**
* Блокировки отражаются в Radar с причиной и explainability

### FR-005 Релизы

**Функции:**
* Пользователь может создать релиз, добавить/убрать фичи, перенести релиз
* Перенос релиза требует подтверждения (дорогая операция)

**AC:**
* Перенос релиза запрашивает подтверждение перед выполнением
* Система сохраняет аудит изменений релиза

### FR-006 Протоколы встреч

**Функции:**
* Система извлекает из голосового протокола: решения, поручения, риски, изменения статусов
* Все извлечённые сущности сохраняются с привязкой к встрече

**AC:**
* Все extracted сущности связаны с уникальным идентификатором встречи
* Система сохраняет аудит создания решений/поручений/рисков

### FR-007 Поручения + напоминания

**Функции:**
* Пользователь может создать поручение голосом с дедлайном и напоминаниями (за день/2 часа/кастом)
* Система отправляет напоминания в заданное время

**AC:**
* Дедлайн и напоминания сохраняются при создании
* Просроченные поручения учитываются Radar как "горит"

### FR-008 Radar top-3

**Функции:**
* Пользователь может запросить "Что горит?", "Где риск?", "Что изменилось?"
* Система возвращает Top-3 items с explainability

**AC:**
* Каждый Radar item содержит ≥2 причины + ссылки на источники данных (rules + entity links)
* Explainability включает: сработавшие правила, даты, статусы, next step

### FR-009 Meeting Prep

**Функции:**
* Пользователь может запросить подготовку к встрече
* Система генерирует 1-page prep: статус, вопросы, критичные моменты

**AC:**
* Создаётся Artifact(type=prep) с привязкой к проекту/встрече
* Опционально генерируется HTML view с приватной ссылкой

### FR-010 Справки по проектам/фичам

**Функции:**
* Пользователь может запросить справку по проекту/фиче
* Система генерирует: цель, описание, метрики, статус, риски, зависимости, релизы, изменения

**AC:**
* Создаётся Artifact(type=brief)
* Опционально генерируется HTML view с приватной ссылкой

### FR-011 Исследования "не тревожь меня"

**Функции:**
* Пользователь может запросить исследование в фоновом режиме
* Система возвращает one-pager с 7 разделами: вопрос, альтернативы, сравнение, рекомендация, риски, допущения, next steps, источники

**AC:**
* Система сохраняет источники и допущения явно
* Создаётся Artifact(type=research) со structured format (7 разделов)

### FR-012 Мультиагентная архитектура

**Функции:**
* Система поддерживает registry агентов, ручной вызов, guided workflows, party mode
* Трассировка: каждая операция фиксирует агента, входы, артефакты
* Agents/Workflows/Rules хранятся как code (YAML/JSON)

**AC:**
* Аудит и трассировка обязательны для всех операций
* Версии конфигов фиксируются при изменении

### FR-013 Auto Rendered HTML Artifacts

**Функции:**
* Система генерирует HTML view для артефактов: report, brief, prep, minutes
* Артефакты доступны через приватные ссылки с TTL=7 дней

**AC:**
* Приватная ссылка содержит трудноугадываемый токен, TTL=7 дней
* Система фиксирует события `artifact_rendered`, `artifact_viewed` в аудите

### FR-014 Leader Tasks Inbox

**Функции:**
* Пользователь может создать поручение от руководителя
* Система создаёт отдельный inbox для leader-поручений с guided review
* Leader P1 поручения влияют на Radar с повышенным приоритетом

**AC:**
* Assignment(source=leader, inbox=leader) создаётся при каждом leader-поручении
* Leader P1 overdue/≤24ч **не подавляется** супрессией в Radar

---

## Non-Functional Requirements

### NFR-001 Performance

* **API response time < 200ms** для 95th percentile запросов под нормальной нагрузкой, измеряется через APM monitoring (Datadog/New Relic)
* **ASR latency < 2 секунды** от получения voice file до транскрипта, измеряется end-to-end latency
* **Radar generation < 5 секунд** для 20 проектов + 200 фич, измеряется server-side execution time

**Метод измерения:** APM tracing + performance logs

### NFR-002 Reliability

* **Uptime ≥ 99.5%** в месячном измерении, измеряется через cloud provider SLA + uptime monitoring
* **Message delivery guarantee:** каждое voice message обрабатывается ровно 1 раз (idempotency через ingestion_id)
* **Audit durability:** EventLog append-only, сохраняется навсегда, репликация в 3 датацентрах

**Метод измерения:** Uptime monitoring (Pingdom) + audit log integrity checks

### NFR-003 Security & Privacy

* **Voice file encryption:** AES-256 at rest, TLS 1.3 in transit
* **User consent:** обязательное согласие перед первой обработкой голоса
* **Voice retention policy:** 30 дней, затем автоудаление (GDPR compliance)
* **Audit trail:** end-to-end audit всех доступов к данным пользователя, retention 90 дней

**Метод измерения:** Security audit + penetration testing + GDPR compliance check

### NFR-004 Scalability

* **100 concurrent users** без деградации latency
* **1000 daily messages per user** обрабатываются без queue delays
* **PostgreSQL до 10M events** в EventLog без performance degradation (p95 query latency < 500ms)

**Метод измерения:** Load testing (k6/Locust) + database performance monitoring

### NFR-005 Observability

* **Distributed tracing coverage: 100%** всех операций (message → workflow → agent → db → artifact)
* **P95 query latency < 500ms** для trace lookups
* **Metrics:** ASR accuracy, NLU intent/slot accuracy, Command Success Rate, Context Correctness Rate

**Метод измерения:** OpenTelemetry + Jaeger/Tempo + Prometheus/Grafana

### NFR-006 Accessibility

* **Text-only fallback mode:** все voice commands доступны через text input для пользователей с ограничениями речи
* **HTML artifacts WCAG 2.1 AA compliant:** screen reader support для всех артефактов
* **Alternative input methods:** text commands для всех voice commands

**Метод измерения:** WCAG audit + manual accessibility testing

### NFR-007 Data Residency

* **Data stored in user-specified region** (EU/US/Asia)
* **No cross-border data transfer** без explicit consent
* **Regional PostgreSQL instances** для compliance

**Метод измерения:** Infrastructure audit + data flow tracing

---

## 13) Radar правила и скоринг (v1.1)

### 13.1 Триггеры "Что горит?"

* Feature Blocked
* релиз ≤7 дней и не Ready/Released
* фича блокирует другие
* churn статусов/переносов за период
* активные риски high/medium
* leader-поручения overdue или ≤24ч (повышенный приоритет)

### 13.2 Скоринг

* `raw_score` = сумма правил без супрессии
* `rank_score` = raw − suppression
* Eligibility: "горит" при `raw_score >= threshold`
* **Leader P1** не подавляется

### 13.3 Explainability контракт

Каждый пункт Radar возвращает:

* сработавшие правила
* фактические данные (даты, статусы, связи)
* ссылки на сущности/артефакты

---

## 14) Артефакты и шаблоны

### 14.1 Project brief (1–2 экрана)

* цель/описание
* метрики
* статус
* релизы
* топ-риски
* изменения
* next steps

### 14.2 Feature brief

* цель/описание
* команды+PO
* статус+причина
* зависимости
* релиз
* история
* риски/next

### 14.3 Meeting minutes

* резюме
* решения
* риски
* поручения (кто/что/когда)
* изменения статусов

### 14.4 Research one-pager (7 разделов)

* вопрос
* альтернативы
* сравнение
* рекомендация
* риски
* допущения
* next steps
* источники

---

## 15) HTML страницы артефактов (FR-013)

### 15.1 Обязательные страницы MVP

* Radar report view
* Brief view (project/feature)
* Meeting prep view
* Minutes view

### 15.2 Контракт хранения

Рекомендуется: `Artifact.content_format=json` + стабильный рендер.

### 15.3 Приватность

* приватная ссылка с TTL=7 дней
* аудит просмотра: `artifact_viewed`
* опционально: одноразовые токены/ротация

---

## 16) Модель данных (PostgreSQL)

### 16.1 Базовые сущности

Project, Idea, Feature, Team, FeatureTeam, Dependency, Release, ReleaseFeature, Meeting, Decision, Risk, Goal, FeatureGoal, Person, Metric, MetricValue, Artifact, EventLog.

### 16.2 Расширение Assignment (Leader Inbox)

* `source_type` = leader | meeting | self | system
* `source_person_id`
* `inbox_type` = general | leader
* `needs_project_link` boolean
* `priority` = P1 | P2 | P3
* `created_from_artifact_id` nullable

### 16.3 Artifact (HTML)

* `content_format` = markdown | json
* `rendered_html`/`rendered_url` nullable
* `render_version` int
* `rendered_at` timestamp

### 16.4 EventLog (новые типы)

* `artifact_rendered`, `artifact_viewed`
* `leader_assignment_created`
* `leader_inbox_review_started/ended`
* `assignment_linked_to_project`

---

## 17) Архитектура (логическая)

### 17.1 Высокоуровневый пайплайн

1. Telegram voice → загрузка/получение файла (Bot API / Local Bot API)
2. ASR → транскрипт
3. NLU → intent + slots + coreference
4. Context resolver → определение активного проекта/режима
5. Orchestrator → выбор агента/workflow
6. Agent execution → чтение/запись в Postgres
7. Artifact builder → сохранение структурированного результата
8. (опц.) HTML render → приватная ссылка + аудит
9. Response composer → ответ по R9 контракту

### 17.2 Идемпотентность и надёжность

* каждое входящее сообщение получает `ingestion_id`
* повторная обработка не создаёт дубликаты (upsert + idempotency keys)
* Audit log — неизменяемый журнал

### 17.3 Observability

* трассировка: message_id → workflow_id → agent_runs → db_writes → artifacts
* метрики качества (см. NFR-005)

---

## 18) Telegram ограничения и решения (R7)

* Bot API download ограничен ~20MB → **Local Bot API Server** как pro-режим
* rate limits → "1 сообщение = 1 результат"
* deep links: start ≤64 символа → ускорение "переключить контекст/открыть артефакт"
* topics-mode — опционально/эксперимент

---

## 19) Безопасность и приватность

* все заметки/артефакты внутри системы
* исследовательские источники фиксируются явно (для доверия)
* HTML ссылки: TTL=7 дней + аудит + трудноугадываемый токен
* разграничение доступов (минимум: по пользователю; далее — по ролям)

---

## 20) QA и качество диалога (R10 — Conversation QA Pack)

### 20.1 Состав QA-пакета

* Golden Dialogues Library (≥30)
* NLU Intent/Slot Matrix
* ASR Quality Set (≥60 аудио)
* E2E harness (проверки БД/аудита/ответов/HTML)
* Style linter (R9)
* Quality gates (пороговые метрики)
* Red-team pack

### 20.2 Блокирующие правила (gates)

* нет строки `Контекст:` → FAIL
* > 1 уточняющего вопроса → FAIL
* изменения без аудита → FAIL
* Radar без "почему" → FAIL
* leader P1 подавлен → FAIL

---

## 21) План реализации (6 спринтов)

**S1** Foundation: voice intake + Postgres + CTX + registry/invoke + аудит + поиск v1
**S2** Workflows + Artifacts + HTML v1: Orchestrator + W2 + PRD-lite + renderer + audit
**S3** Meetings + Party mode v1 + Leader capture: W3 + party + leader capture/list
**S4** Reminders + Leader review + Radar v1.1: reminders + W8 + Radar + explainability + HTML report
**S5** Releases + Meeting Prep + Risk Manager: релизы + W5 + риск-модель
**S6** Researcher + Reviewer + Hardening + as-code: "не тревожь" + reviewer + конфиги

---

## 22) Открытые вопросы (backlog)

1. Точный формат хранения `Artifact.content_format=json` (схемы по типам артефактов).
2. Стратегия coreference ("это/там/по нему") и контекстного разрешения.
3. Настройка TTL/политики доступа для HTML ссылок (внутренний хостинг/прокси).
4. Политика подтверждений для "дорогих" операций (массовые переносы/удаления).
5. Версионирование rules/workflows/agents и миграции при изменении схемы.

---

## 23) Приложение A — Словарь голосовых команд (MVP)

* Контекст: "Где я сейчас?", "Переключись на проект X", "Сбрось контекст", "По всем проектам…"
* Агенты: "Покажи доступных агентов", "Вызови агента…", "Выйди из агента"
* Workflows: "Запусти workflow…", "Останови workflow", "Прогресс"
* Проекты/идеи: "Создай проект…", "Идея по проекту…", "Покажи мои идеи…"
* Фичи/статусы: "Создай фичу…", "Поменяй статус… причина…"
* Встречи: "Сделай протокол…", "Подготовь к встрече…"
* Radar: "Что горит?", "Где риск?", "Что изменилось за неделю?"
* Поручения: "Поручение… до… напомни…"
* Leader: "Поручение от руководителя…", "Покажи поручения от руководителя", "Разбери…"
* HTML: "Сгенерируй сайт…", "Открой сайт последнего отчёта", "Без сайта"

---

## 24) Приложение B — Мини-пример "as-code" (для агента-разработчика)

```yaml
agents:
  - id: orchestrator
    name: Orchestrator
    responsibilities: [route_intents, run_workflows, handoff, quality_control, audit]
    produces_artifacts: [brief, report, minutes, prep, prd_lite]

workflows:
  - id: w4_radar
    name: Radar: hot/risk/changed
    steps:
      - detect_scope_and_context
      - fetch_signals_from_db
      - score_items_with_rules
      - build_explainability
      - save_artifact_report
      - render_html_if_enabled
      - compose_voice_response

radar_rules:
  - id: leader_p1_urgent
    description: "Leader P1 overdue or <=24h must surface"
    raw_score: 100
    suppressible: false
```
